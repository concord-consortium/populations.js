// Generated by CoffeeScript 1.7.1
(function() {
  var Environment, Rule, col, env, row, water, _i, _j, _ref, _ref1;

  Environment = require('models/environment');

  Rule = require('models/rule');

  env = new Environment({
    columns: 70,
    rows: 74,
    imgPath: "images/environments/water10levels.png",
    winterImgPath: "images/environments/snow-overlay.png",
    seasonLengths: [30, 30, 15, 10],
    barriers: [[0, 670, 700, 70]],
    wrapEastWest: false,
    wrapNorthSouth: false
  });

  for (col = _i = 0, _ref = env.columns; 0 <= _ref ? _i <= _ref : _i >= _ref; col = 0 <= _ref ? ++_i : --_i) {
    water = col / env.columns;
    for (row = _j = 0, _ref1 = env.rows; 0 <= _ref1 ? _j <= _ref1 : _j >= _ref1; row = 0 <= _ref1 ? ++_j : --_j) {
      env.set(col, row, "water", water);
    }
  }

  env.addRule(new Rule({
    action: function(agent) {
      var a, b, c, diff, h, healthAtOneUnitDiff, size;
      size = agent.get('root size');
      water = agent.get('water');
      diff = Math.abs(size - (water * 10));
      healthAtOneUnitDiff = 0.983;
      a = 0.2 - 0.25 * healthAtOneUnitDiff;
      b = 1.25 * healthAtOneUnitDiff - 1.2;
      c = 1;
      h = a * diff * diff + b * diff + c;
      h = Math.max(h, 0);
      return agent.set('health', h);
    }
  }));

  env.addRule(new Rule({
    test: function(agent) {
      return agent.get('health') <= 0.99;
    },
    action: function(agent) {
      return agent.set('chance of flowering', 0);
    }
  }));

  env.addRule(new Rule({
    test: function(agent) {
      var season;
      season = agent.get('season');
      return agent.get('health') > 0.9 && (season === "spring" || season === "summer");
    },
    action: function(agent) {
      return agent.set('is immortal', true);
    }
  }));

  env.addRule(new Rule({
    test: function(agent) {
      return agent.get('season') === "fall";
    },
    action: function(agent) {
      return agent.set('is immortal', false);
    }
  }));

  require.register("environments/water-field", function(exports, require, module) {
    return module.exports = env;
  });

}).call(this);
