// Generated by CoffeeScript 1.7.1
(function() {
  var Environment, Rule, col, env, row, sunlight, _i, _j;

  Environment = require('models/environment');

  Rule = require('models/rule');

  env = new Environment({
    columns: 60,
    rows: 70,
    imgPath: "images/environments/sun10levels.png",
    winterImgPath: "images/environments/snow-overlay.png",
    seasonLengths: [30, 30, 15, 10],
    barriers: [[0, 0, 70, 700]],
    wrapEastWest: false,
    wrapNorthSouth: false
  });

  for (col = _i = 0; _i <= 60; col = ++_i) {
    for (row = _j = 0; _j <= 70; row = ++_j) {
      sunlight = Math.ceil(row / 7);
      env.set(col, row, "sunlight", sunlight);
    }
  }

  env.addRule(new Rule({
    action: function(agent) {
      var a, b, c, diff, health, healthAtOneUnitDiff, size;
      size = agent.get('size');
      sunlight = agent.get('sunlight');
      diff = Math.abs((11 - size) - sunlight);
      healthAtOneUnitDiff = 0.98;
      a = 0.2 - 0.25 * healthAtOneUnitDiff;
      b = 1.25 * healthAtOneUnitDiff - 1.2;
      c = 1;
      health = Math.max(0, a * diff * diff + b * diff + c);
      return agent.set('health', health);
    }
  }));

  env.addRule(new Rule({
    test: function(agent) {
      return agent.get('health') <= 0.99;
    },
    action: function(agent) {
      return agent.set('chance of flowering', 0);
    }
  }));

  env.addRule(new Rule({
    test: function(agent) {
      var season;
      season = agent.get('season');
      return agent.get('health') > 0.9 && (season === "spring" || season === "summer");
    },
    action: function(agent) {
      return agent.set('is immortal', true);
    }
  }));

  env.addRule(new Rule({
    test: function(agent) {
      return agent.get('season') === "fall";
    },
    action: function(agent) {
      return agent.set('is immortal', false);
    }
  }));

  require.register("environments/sunlight-field", function(exports, require, module) {
    return module.exports = env;
  });

}).call(this);
