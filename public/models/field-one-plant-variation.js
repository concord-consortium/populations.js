// Generated by CoffeeScript 1.7.1
(function() {
  var Agent, Environment, Events, Interactive, Rule, Species, ToolButton, Trait, env, helpers, plantSpecies;

  helpers = require('helpers');

  Environment = require('models/environment');

  Species = require('models/species');

  Agent = require('models/agent');

  Rule = require('models/rule');

  Trait = require('models/trait');

  Interactive = require('interactive/interactive');

  Events = require('events');

  ToolButton = require('interactive/tool-button');

  plantSpecies = require('species/varied-plants');

  env = require('environments/sunlight-field');

  window.model = {
    run: function() {
      plantSpecies.defs.CHANCE_OF_MUTATION = 0.3;
      plantSpecies.setMutatable('root size', false);
      this.interactive = new Interactive({
        environment: env,
        speedSlider: true,
        addOrganismButtons: [
          {
            species: plantSpecies,
            imagePath: "images/agents/varied-plants/buttons/seedpack_6.png",
            traits: [
              new Trait({
                name: "size",
                "default": 5
              }), new Trait({
                name: "root size",
                "default": 5
              })
            ]
          }
        ],
        toolButtons: [
          {
            type: ToolButton.INFO_TOOL
          }
        ]
      });
      document.getElementById('environment').appendChild(this.interactive.getEnvironmentPane());
      this.env = env;
      return this.plantSpecies = plantSpecies;
    },
    chartData: null,
    chart: null,
    setupChart: function() {
      var options;
      this.chartData = new google.visualization.DataTable();
      this.chartData.addColumn('string', 'Plant Type (Leaf Size)');
      this.chartData.addColumn('number', 'Flowers');
      this.chartData.addColumn({
        type: 'string',
        role: 'style'
      });
      this.chartData.addRows([["1", 0, "color: #5942BF"], ["2", 0, "color: #5F42B8"], ["3", 0, "color: #65429F"], ["4", 0, "color: #73419E"], ["5", 0, "color: #874084"], ["6", 0, "color: #904078"], ["7", 0, "color: #9F416B"], ["8", 0, "color: #B5435A"], ["9", 0, "color: #C84349"], ["10", 0, "color: #D34441"]]);
      options = {
        title: 'Number of Flowers',
        hAxis: {
          title: 'Plant Type (Leaf Size)'
        },
        vAxis: {
          title: 'Flowers',
          minValue: 0,
          maxValue: 10,
          gridlines: {
            count: 6
          }
        },
        legend: {
          position: 'none'
        },
        width: 500,
        height: 400
      };
      this.chart = new google.visualization.ColumnChart(document.getElementById('chart'));
      this.chart.draw(this.chartData, options);
      return Events.addEventListener(Environment.EVENTS.STEP, (function(_this) {
        return function() {
          var agent, counts, i, _i, _j, _k, _len, _ref;
          if (_this.env.get(0, 0, "season") !== "summer") {
            return;
          }
          counts = [];
          for (i = _i = 0; _i <= 9; i = ++_i) {
            counts.push(0);
          }
          _ref = _this.env.agents;
          for (_j = 0, _len = _ref.length; _j < _len; _j++) {
            agent = _ref[_j];
            if (agent.get('has flowers')) {
              counts[agent.get('size')] += 1;
            }
          }
          for (i = _k = 0; _k <= 8; i = ++_k) {
            _this.chartData.setValue(i, 1, counts[i + 1]);
          }
          if (counts[1] > 10 || counts[5] > 10 || counts[9] > 10) {
            options.vAxis.gridlines.count = -1;
          }
          return _this.chart.draw(_this.chartData, options);
        };
      })(this));
    },
    preload: ["images/agents/varied-plants/buttons/seedpack_6.png"]
  };

  window.onload = function() {
    return helpers.preload([model, env, plantSpecies], function() {
      model.run();
      return model.setupChart();
    });
  };

}).call(this);
