!function(){"use strict";var t="undefined"!=typeof window?window:global;if("function"!=typeof t.require){var e={},i={},n=function(t,e){return{}.hasOwnProperty.call(t,e)},r=function(t,e){var i,n,r=[];i=/^\.\.?(\/|$)/.test(e)?[t,e].join("/").split("/"):e.split("/");for(var s=0,o=i.length;o>s;s++)n=i[s],".."===n?r.pop():"."!==n&&""!==n&&r.push(n);return r.join("/")},s=function(t){return t.split("/").slice(0,-1).join("/")},o=function(e){return function(i){var n=s(e),o=r(n,i);return t.require(o,e)}},a=function(t,e){var n={id:t,exports:{}};return i[t]=n,e(n.exports,o(t),n),n.exports},h=function(t,s){var o=r(t,".");if(null==s&&(s="/"),n(i,o))return i[o].exports;if(n(e,o))return a(o,e[o]);var h=r(o,"./index");if(n(i,h))return i[h].exports;if(n(e,h))return a(h,e[h]);throw new Error('Cannot find module "'+t+'" from "'+s+'"')},u=function(t,i){if("object"==typeof t)for(var r in t)n(t,r)&&(e[r]=t[r]);else e[t]=i},l=function(){var t=[];for(var i in e)n(e,i)&&t.push(i);return t};t.require=h,t.require.define=u,t.require.register=u,t.require.list=l,t.require.brunch=!0}}(),require.register("animated-sprite",function(){PIXI.AnimatedSprite=function(t,e){var i;if(this.sequences=t,null==e)for(i in t){this.currentSequence=i;break}else this.currentSequence=e;this.frames=this.sequences[this.currentSequence].frames,this.frameRate=this.sequences[this.currentSequence].frameRate||60,this.loop=this.sequences[this.currentSequence].loop||!1,PIXI.Sprite.call(this,this.frames[0]),this.anchor.x=this.anchor.y=.5,this.onComplete=null,this.currentFrame=0,this.previousFrame,this.playing=!1,this.loop=!1},PIXI.AnimatedSprite.constructor=PIXI.AnimatedSprite,PIXI.AnimatedSprite.prototype=Object.create(PIXI.Sprite.prototype),PIXI.AnimatedSprite.prototype.gotoAndPlay=function(t){"[object String]"===Object.prototype.toString.call(t)?(this.currentFrame=0,this.currentSequence=t,this.frames=this.sequences[t].frames,this.frameRate=this.sequences[t].frameRate||60,this.loop=this.sequences[t].loop||!1):this.currentFrame=t,this.playing=!0},PIXI.AnimatedSprite.prototype.gotoAndStop=function(t){"[object String]"===Object.prototype.toString.call(t)?(this.currentFrame=0,this.currentSequence=t,this.frames=this.sequences[t].frames,this.frameRate=this.sequences[t].frameRate||60,this.loop=this.sequences[t].loop||!1):this.currentFrame=t,this.setTexture(this.frames[this.currentFrame]),this.playing=!1},PIXI.AnimatedSprite.prototype.play=function(){this.playing=!0},PIXI.AnimatedSprite.prototype.stop=function(){this.playing=!1},PIXI.AnimatedSprite.prototype.advanceTime=function(t){var e;"undefined"==typeof t&&(t=1/60),this.playing&&(this.currentFrame+=this.frameRate*t,e=Math.floor(Math.min(this.currentFrame,this.frames.length-1)),this.setTexture(this.frames[e]),this.currentFrame>=this.frames.length&&(this.loop?this.gotoAndPlay(0):this.stop(),this.onComplete&&this.onComplete(this.currentSequence)))}}),require.register("events",function(t,e,i){var n;i.exports=n=function(){function t(){}return t.dispatchEvent=function(t,e){var i;return null!=document.dispatchEvent?(i=new CustomEvent(t,{detail:e}),document.dispatchEvent(i)):console.warn("document doesn't support dispatchEvent!")},t.addEventListener=function(t,e){return null!=document.addEventListener?document.addEventListener(t,e):console.warn("document doesn't support addEventListener!")},t}(),function(){var t;return window.CustomEvent&&"function"==typeof window.CustomEvent?void 0:(t=function(t,e){var i;return i=document.createEvent("CustomEvent"),i.initCustomEvent(t,!(!e||!e.bubbles),!(!e||!e.cancelable),e?e.detail:null),i},window.CustomEvent=t)}(),function(){var t;return null==window.TouchEvent?(console.log("Shimming TouchEvent..."),window.TouchEvent=t=function(){function t(){}return t}()):void 0}()}),require.register("helpers",function(t,e,i){var n=[].slice,r={}.hasOwnProperty,s=function(t,e){function i(){this.constructor=t}for(var n in e)r.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};Array.prototype.remove=function(t,e){var i;return i=this.slice((e||t)+1||this.length),this.length=0>t?this.length+t:t,this.push.apply(this,i)},Array.prototype.removeObj=function(t){var e;return e=this.indexOf(t),~e?(this.remove(e),!0):!1},Array.prototype.replaceFirst=function(t,e){return this[this.indexOf(t)]=e},Array.prototype.shuffle=function(){var t,e,i;if(i=this.length)for(;--i;)t=Math.floor(Math.random()*(i+1)),e=this[t],this[t]=this[i],this[i]=e;return this},Array.prototype.randomElement=function(){return this[Math.floor(Math.random()*this.length)]},window.ExtMath={},ExtMath.randomInt=function(t){return Math.floor(Math.random()*t)},ExtMath.randomFloat=function(t){return null==t&&(t=1),Math.random()*t},ExtMath.randomValue=function(t,e){var i,n;return e>=t?(n=t,i=e):(n=e,i=t),n+Math.random()*(i-n)},ExtMath.randomGaussianIrwinHall=function(t){var e,i,n;for(null==t&&(t={}),null==t.mean&&(t.mean=0),null==t.deviation&&(t.deviation=1),i=0,e=n=1;12>=n;e=++n)i+=Math.random()-.5;return i*t.deviation+t.mean},ExtMath._haveNextNextGuassian=!1,ExtMath._nextNextGuassian=0,ExtMath.randomGaussianJava=function(t){var e,i,n,r;if(null==t&&(t={}),ExtMath._haveNextNextGaussian)return ExtMath._haveNextNextGaussian=!1,ExtMath._nextNextGaussian;for(i=0;i>=1||0===i;)n=2*Math.random()-1,r=2*Math.random()-1,i=n*n+r*r;return e=Math.sqrt(-2*Math.log(i)/i),ExtMath._nextNextGaussian=r*e,ExtMath._haveNextNextGaussian=!0,n*e},ExtMath.randomGaussian=function(t){return null==t&&(t={}),ExtMath.randomGaussianJava(t)},ExtMath.flip=function(){return ExtMath.randomInt(2)},ExtMath.HALF_PI=Math.PI/2,ExtMath.TWO_PI=2*Math.PI,ExtMath.normalizeRads=function(t){return t-ExtMath.TWO_PI*Math.floor((t+Math.PI)/ExtMath.TWO_PI)},i.exports={setDefaults:function(t,e){var i;for(i in e)void 0===t[i]?t[i]=e[i]:"object"==typeof t[i]&&(t[i]=this.setDefaults(t[i],e[i]));return t},clone:function(t){var e,i;if(null==t||"object"!=typeof t)return t;e=new t.constructor;for(i in t)e[i]=this.clone(t[i]);return e},showMessage:function(t,e,i){var n,r,s,o,a,h,u,l,p;for(p=document.getElementsByClassName("message-box"),u=0,l=p.length;l>u;u++)o=p[u],o.remove();return a=e.offsetTop+50,h=280,s=e.offsetLeft+e.offsetWidth/2-h/2,n=document.createElement("div"),n.classList.add("message-box"),n.setAttribute("style","top: "+a+"px;\nleft: "+s+"px;\nwidth: "+h+"px;"),n.innerHTML=t,r=document.createElement("div"),r.classList.add("button"),r.innerHTML="Ok",r.addEventListener("click",function(){return e.removeChild(n),i?i():void 0}),n.appendChild(r),e.appendChild(n)},stringify:function(t){var e,i;if(null==t||"object"!=typeof t)return String(t);i="{ ";for(e in t)i+=String(e)+": "+this.stringify(t[e]+", ");return i.slice(0,i.length-2)+" }"},preload:function(t,e){var i,n,r,s,o,a,h,u,l,p,c,d;for(a=document.createElement("div"),a.classList.add("preload-message"),h=document.createElement("div"),h.classList.add("text"),h.innerHTML="Loading... 0% complete.",a.appendChild(h),document.body.appendChild(a),n=[],u=0,p=t.length;p>u;u++)if(o=t[u],null!=o.preload)for(d=o.preload,l=0,c=d.length;c>l;l++)i=d[l],n.push(i);return s=null,r=new PIXI.AssetLoader(n),r.onProgress=function(){return s||(s=r.loadCount+1),h.innerHTML="Loading... "+Math.floor((s-r.loadCount)/s*100)+"%"},r.onComplete=function(){return h.innerHTML="Loading complete!",setTimeout(function(){return e(),document.body.removeChild(a)},10)},r.load()},mixOf:function(){var t,e,i,r,o,a,h,u,l;for(e=arguments[0],o=2<=arguments.length?n.call(arguments,1):[],t=function(t){function e(){return u=e.__super__.constructor.apply(this,arguments)}return s(e,t),e}(e),h=o.length-1;h>=0;h+=-1){r=o[h],l=r.prototype;for(a in l)i=l[a],t.prototype[a]=i}return t}}}),require.register("models/agent",function(t,e,i){var n,r,s,o,a={}.hasOwnProperty;r=e("views/agent-view"),o=e("helpers"),s={"min offspring":1,"max offspring":3,"min offspring distance":10,"max offspring distance":40,health:1,"is immortal":!1,"resource deficit":0,"resource consumption rate":1},i.exports=n=function(){function t(t){var e,i,n,a;this.name=t.name,this.environment=t.environment,this.species=t.species,i=t.x,n=t.y,e=t.additionalDefaults,this._props=o.clone(s),null!=e&&(this._props=o.setDefaults(this._props,e)),this._view=new r({agent:this}),null!=(null!=(a=this.species)?a.viewLayer:void 0)&&(this._viewLayer=this.species.viewLayer),null!=i&&null!=n&&this.setLocation({x:i,y:n}),this.alleles={},this.makeNewborn()}return t.prototype.label="organism",t.prototype.bred=!1,t.prototype._viewLayer=1,t.prototype.getView=function(){return this._view},t.prototype.setLocation=function(t){var e,i,n;return e=t.x,i=t.y,this.environment&&(n=this.environment.ensureValidLocation({x:e,y:i}),e=n.x,i=n.y),this._x=e,this._y=i},t.prototype.getLocation=function(){return{x:this._x,y:this._y}},t.prototype.set=function(t,e){return this._props[t]=e},t.prototype.get=function(t){var e;if(e=this.hasProp(t)?this._props[t]:this.getEnvironmentProperty(t),null==e)throw new Error("Cannot find property "+t);return e},t.prototype.hasProp=function(t){return null!=this._props[t]},t.prototype.getAllProperties=function(){return this._props},t.prototype.getEnvironmentProperty=function(t){return null==this.environment?null:this.environment.getAt(this._x,this._y,t)},t.prototype.setEnvironmentProperty=function(t,e){return null!=this.environment?this.environment.setAt(this._x,this._y,t,e):void 0},t.prototype.getImages=function(t){return null==t&&(t={}),this.species.getImages(this,t)},t.prototype.getSize=function(){var t;return this.species.defs.MATURITY_AGE?(t=this.get("age")/this.species.defs.MATURITY_AGE,Math.min(t,1)):1},t.prototype.isDead=!1,t.prototype.die=function(){return this.isDead=!0},t.prototype.step=function(){return this._incrementAge(),this._checkSurvival()},t.prototype.makeNewborn=function(){return this.set("age",0)},t.prototype.reproduce=function(t){var e,i,n,r,s,o;for(n=this.get("min offspring"),i=this.get("max offspring"),r=n+ExtMath.randomInt(1+i-n),o=[],e=s=0;r>=0?r>s:s>r;e=r>=0?++s:--s)o.push(this.createOffspring(t));return o},t.prototype.createOffspring=function(t){var e;return e=this._breed(t),e._mutate(null!=e.organism),e.makeNewborn(),e.resetGeneticTraits(null==e.organism),e.bred=!0,this.environment&&(e.setLocation(this._findOffspringLocation()),this.environment.addAgent(e)),e},t.prototype.resetGeneticTraits=function(t){var e,i,n,r,s,o,h,u,l,p;if(null==t&&(t=!0),null!=this.species.geneticSpecies){if(t){r=this.hasProp("sex")&&"male"===this.get("sex")?BioLogica.MALE:BioLogica.FEMALE,i=[],u=this.alleles;for(s in u)a.call(u,s)&&(e=u[s],i.push(e));this.organism=new BioLogica.Organism(this.species.geneticSpecies,i.join(),r)}for(l=this.species.traits,p=[],o=0,h=l.length;h>o;o++)s=l[o],s.isGenetic?(n=this.organism.getCharacteristic(s.name),p.push(s.isNumeric?this.set(s.name,s["float"]?parseFloat(n):parseInt(n)):this.set(s.name,n))):p.push(void 0);return p}},t.prototype._clone=function(){var t,e,i,n,r;e=this.species.createAgent();for(i in this._props)e.set(i,this._props[i]);r=this.alleles;for(n in r)t=r[n],e.alleles[n]=t;return e},t.prototype._breed=function(t){var e,i,n,r,s,o,a,h;if(i=this._clone(),null!=this.species.geneticSpecies&&null!=this.organism&&null!=(null!=t?t.organism:void 0))for(this.hasProp("sex")&&"male"===this.get("sex")?(r=t.organism,n=this.organism):(r=this.organism,n=t.organism),i.organism=BioLogica.breed(r,n,!1),i.hasProp("sex")&&i.set("sex",i.organism.sex===BioLogica.FEMALE?"female":"male"),h=this.species.traits,o=0,a=h.length;a>o;o++)s=h[o],s.isGenetic&&(e=i.organism.getAlleleStringForTrait(s.name),i.alleles[s.name]=e);return i},t.prototype._mutate=function(t){var e,i,n,r,s,o,a;for(null==t&&(t=!1),o=this.species.traits,a=[],r=0,s=o.length;s>r;r++)if(n=o[r],n.mutatable&&Math.random()<this.species.defs.CHANCE_OF_MUTATION)if(n.isGenetic){if(t)continue;e=this.alleles[n.name],i=n.mutate(e),a.push(this.alleles[n.name]=i)}else e=this.get(n.name),i=n.mutate(e),a.push(this.set(n.name,i));else a.push(void 0);return a},t.prototype._findOffspringLocation=function(){var t,e,i,n,r,s,o;return i=this.getLocation(),r=this.get("min offspring distance"),n=this.get("max offspring distance"),e=ExtMath.randomValue(r,n),t=2*Math.random()*Math.PI,s=Math.floor(e*Math.sin(t)),o=Math.floor(e*Math.cos(t)),{x:i.x+s,y:i.y+o}},t.prototype._incrementAge=function(){return this.set("age",this.get("age")+1)},t.prototype._consumeResources=function(){var t,e,i,n;return i=this.getEnvironmentProperty("food"),t=this.get("resource consumption rate"),i>=t?(this.setEnvironmentProperty("food",i-t),this.set("resource deficit",0)):(n=t-i,e=this.get("resource deficit"),this.set("resource deficit",e+n),this.setEnvironmentProperty("food",0))},t.prototype._checkSurvival=function(){var t;return t=this.hasProp("chance of survival")?this.get("chance of survival"):this._getSurvivalChances(),Math.random()>t?this.die():void 0},t.prototype._getSurvivalChances=function(){var t,e,i,n,r,s;return this.get("is immortal")?1:(t=this.get("age"),e=this.species.defs.MAX_AGE||2e3,i=1-t/e,r=this.get("resource deficit"),s=1-Math.pow(r/100,2),n=this.get("health")/this.species.defs.MAX_HEALTH,i*s*n)},t}()}),require.register("models/agents/animated-agent",function(t,e,i){var n;i.exports=n=function(){function t(){}return t.MOVEMENTS={STOP:"stop",MOVESTEP:"move-step"},t.prototype.currentMovement=t.MOVEMENTS.STOPPED,t.prototype.setMovement=function(t){return void(this.currentMovement=t)},t.prototype.getMovement=function(){return this.currentMovement},t}()}),require.register("models/agents/basic-animal",function(t,e,i){var n,r,s,o,a,h,u,l,p={}.hasOwnProperty,c=function(t,e){function i(){this.constructor=t}for(var n in e)p.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};n=e("models/agent"),a=e("events"),o=e("models/environment"),h=e("models/trait"),l=e("helpers"),u={direction:0,speed:1,"default speed":10,sex:"female",prey:[],predator:[],"hiding place":[],"chance of being seen":1,"max energy":100,energy:100,metabolism:3,"vision distance":300,"eating distance":50,"mating distance":50,"current behavior":"wandering","calculate drives":!0,"hunger bonus":0,"mating desire bonus":0,"fear bonus":0,"wandering threshold":5,"bubble showing":"none"},i.exports=s=function(t){function e(t){var i;i=null!=t.additionalDefaults?l.setDefaults(l.clone(u),t.additionalDefaults):l.clone(u),t.additionalDefaults=i,e.__super__.constructor.call(this,t)}return c(e,t),e.prototype.label="animal",e.prototype._viewLayer=2,e.prototype._hasEatenOnce=!1,e.prototype._timeLastMated=-20,e.BEHAVIOR={EATING:"eating",MATING:"mating",FLEEING:"fleeing",HIDING:"hiding",WANDERING:"wandering"},e.prototype.makeNewborn=function(){return e.__super__.makeNewborn.call(this),this.set("sex",0===ExtMath.flip()?"female":"male"),this.set("energy",this.get("max energy")),this.set("direction",ExtMath.randomFloat(2*Math.PI)),this.set("speed",this.get("default speed"))},e.prototype.step=function(){switch(this._closestAgents=null,this._setSpeedAppropriateForAge(),this._depleteEnergy(),this.get("calculate drives")&&this.set("current behavior",this._determineBehavior()),this.get("current behavior")){case e.BEHAVIOR.EATING:this.eat();break;case e.BEHAVIOR.FLEEING:this.flee();break;case e.BEHAVIOR.MATING:this.mate();break;case e.BEHAVIOR.WANDERING:this.wander()}return this._incrementAge(),this._checkSurvival()},e.prototype.eat=function(){var t,e;return e=this._nearestPrey(),null!=e?(t=this.get("eating distance"),e.distanceSq<Math.pow(t,2)?this._eatPrey(e.agent):this.chase(e)):this.wander(.75*this.get("speed"))},e.prototype.flee=function(){var t,i,n;return i=this._nearestPredator(),null==i?this.wander():(t=this._nearestHidingPlace(),null==t?this.runFrom(i):(n=this.get("speed"),this.set("speed",6*n),this.chase(t),this.set("speed",n),t.distanceSq<Math.pow(this.get("speed"),2)?this.set("current behavior",e.BEHAVIOR.HIDING):void 0))},e.prototype.mate=function(){var t,e;return e=this._nearestMate(),null==e?this.wander(this.get("speed")*Math.random()*.75):(this.chase(e),e.distanceSq<Math.pow(this.get("mating distance"),2)&&(null==this.species.defs.CHANCE_OF_MATING||Math.random()<this.species.defs.CHANCE_OF_MATING)?(t=this.get("max offspring"),this.set("max offspring",Math.max(t/2,1)),this.reproduce(e),this.set("max offspring",t),this._timeLastMated=this.environment.date):void 0)},e.prototype.wander=function(t){var e;return null==t&&(e=this.get("speed"),t=e/2+ExtMath.randomGaussian()*(e/6)),this.set("direction",this.get("direction")+ExtMath.randomGaussian()/10),this.move(t)},e.prototype.chase=function(t){var e,i,n,r;return i=this._direction(this.getLocation(),t.agent.getLocation()),e=ExtMath.normalizeRads(i-this.get("direction")),n=this.get("direction")+e/10,this.set("direction",n),r=Math.min(this.get("speed"),Math.sqrt(t.distanceSq)),this.move(r)},e.prototype.runFrom=function(t){var e,i;return i=this._direction(this.getLocation(),t.agent.getLocation())+Math.PI+ExtMath.randomGaussian/3,e=(19*this.get("direction")+i)/20,this.set("direction",e),this.move(this.get("speed"))},e.prototype.move=function(t){var e,i,n,r,s;if(e=this.get("direction"),0!==t){if("number"!=typeof t)throw new Error("invalid speed");if("number"!=typeof e)throw new Error("invalid direction");return r=this.getLocation(),i=t*Math.cos(e),n=t*Math.sin(e),s={x:r.x+i,y:r.y+n},this.environment.crossesBarrier(r,s)?this.set("direction",e+Math.PI):this.setLocation(s)}},e.prototype._direction=function(t,e){var i,n;return i=e.x-t.x,n=e.y-t.y,ExtMath.normalizeRads(Math.atan2(n,i))},e.prototype._eatPrey=function(t){var e,i;return i=t.get("food"),e=this.get("energy"),this.set("energy",Math.min(this.get("max energy"),e+i)),t.die(),this._hasEatenOnce=!0,a.dispatchEvent(o.EVENTS.AGENT_EATEN,{predator:this,prey:t})},e.prototype._setSpeedAppropriateForAge=function(){var t,e;return t=this.get("age"),e=this.get("default speed"),5>t?e=2:10>t&&(e=5),this.set("speed",e)},e.prototype._depleteEnergy=function(){var t,i,n;return i=this.get("energy"),n=this.get("metabolism"),t=this.get("current behavior"),t===e.BEHAVIOR.HIDING&&(n/=2),this.set("energy",Math.max(0,i-n))},e.prototype._hunger=function(){var t,e;return t=this.get("energy")/this.get("max energy"),e=100-this.get("hunger bonus"),100-e*t},e.prototype._fear=function(){var t,e,i;return!this.get("predator")instanceof String&&(t=this._nearestPredator(),null!=t)?(i=this.get("vision distance"),e=(i-Math.sqrt(t.distanceSq))/i,Math.pow(10*e,2)):0},e.prototype._desireToMate=function(){var t,e,i,n;return t=this.get("age"),null!=this.species.defs.MATURITY_AGE&&t<this.species.defs.MATURITY_AGE?0:this.get("max offspring")<1?0:this._hasEatenOnce?this.environment.date-this._timeLastMated<20?0:(i=null!=this._nearestMate()?30:15,n=null!=this._nearestMatingMate()?15:0,e=this.get("mating desire bonus"),i+n+e):0},e.prototype._determineBehavior=function(){var t,i,n,r,s;return n=this._hunger(),i=this._fear(),t=this._desireToMate(),s=this.get("wandering threshold"),s>n&&s>i&&s>t?e.BEHAVIOR.WANDERING:(r=Math.max(Math.max(n,i),t),r===i?e.BEHAVIOR.FLEEING:r===n?e.BEHAVIOR.EATING:e.BEHAVIOR.MATING)},e.prototype._nearestPredator=function(){var t,e;return e=this.get("predator"),null!=e&&null!=e.length&&e.length>0?(t=this._nearestAgentsMatching({types:e,quantity:1}),t[0]||null):null},e.prototype._nearestPrey=function(){var t,e;return e=this.get("prey"),null!=e&&null!=e.length&&e.length>0?(t=this._nearestAgentsMatching({types:e}),t[ExtMath.randomInt(t.length)]):null},e.prototype._nearestHidingPlace=function(){var t,e;return t=this.get("hiding place"),null!=t&&null!=t.length&&t.length>0?(e=this._nearestAgentsMatching({types:t,quantity:1}),e[0]||null):null},e.prototype._nearestMate=function(){var t,e,i;return t="male"===this.get("sex")?"female":"male",i=new h({name:"sex",possibleValues:[t]}),e=this._nearestAgentsMatching({types:[{name:this.species.speciesName,traits:[i]}],quantity:1,mating:!0}),e[0]||null},e.prototype._nearestMatingMate=function(){var t,i,n,r;return t="male"===this.get("sex")?"female":"male",n=new h({name:"sex",possibleValues:[t]}),r=new h({name:"current behavior",possibleValues:[e.BEHAVIOR.MATING]}),i=this._nearestAgentsMatching({types:[{name:this.species.speciesName,traits:[n,r]}],quantity:1,mating:!0}),i[0]||null},e.prototype._nearestAgents=function(){var t,e,i,n,s,o,a,h;if(null!=this._closestAgents)return this._closestAgents;for(i=this.getLocation(),o=this.get("vision distance"),null==o&&(o=15*this.get("speed")),s={x:i.x-o,y:i.y-o,width:2*o,height:2*o},n=this.environment.agentsWithin(s),e=[],a=0,h=n.length;h>a;a++)t=n[a],e.push(new r(t,this._distanceSquared(i,t.getLocation())));return this._closestAgents=e.sort(function(t,e){return t.distanceSq-e.distanceSq}),this._closestAgents},e.prototype._nearestAgentsMatching=function(t){var i,n,r,s,o,a,h,u,p,c,d,f,g,m,v,y;if(o=l.setDefaults(t,{camo:!0,mating:!1,quantity:3,crossBarriers:!1}),null==o.types&&"object"==typeof o.types&&null!=o.types.length)throw new Error("Must pass agent types array");for(r=this._nearestAgents(),a=[],p=0,f=r.length;f>p;p++)for(n=r[p],i=n.agent,v=o.types,c=0,g=v.length;g>c;c++){if(u=v[c],"object"!=typeof u||null==u.name)throw new Error("types array must be an array of objects in format {name: 'foo', traits: []}");if(u.name===i.species.speciesName&&i!==this&&!(o.camo&&!o.mating&&i instanceof e&&ExtMath.randomFloat()>i.get("chance of being seen")||i.hasProp("current behavior")&&i.get("current behavior")===e.BEHAVIOR.HIDING||!o.crossBarriers&&this.environment.crossesBarrier(this.getLocation(),i.getLocation()))){if(null!=u.traits&&u.traits.length>0){for(s=!1,y=u.traits,d=0,m=y.length;m>d;d++)h=y[d],h.isPossibleValue(i.get(h.name))||(s=!0);if(s)continue}if(a.push(n),a.length>=o.quantity)return a}}return a},e.prototype._distanceSquared=function(t,e){var i,n;return i=t.x-e.x,n=t.y-e.y,i*i+n*n},e.prototype._getSurvivalChances=function(){var t,i,n;return this.get("is immortal")?1:(t=e.__super__._getSurvivalChances.call(this),i=this.get("energy"),n=1-Math.pow(1-i/100,8),t*n)},e}(n),r=function(){function t(t,e){this.agent=t,this.distanceSq=e}return t}()}),require.register("models/agents/basic-plant",function(t,e,i){var n,r,s,o,a={}.hasOwnProperty,h=function(t,e){function i(){this.constructor=t}for(var n in e)a.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};n=e("models/agent"),o=e("helpers"),s={"is seed":!0,"can seed":!0,"has flowers":!1,"chance of flowering":1},i.exports=r=function(t){function e(t){e.__super__.constructor.call(this,t),this._props=o.setDefaults(this._props,s)}return h(e,t),e.prototype.label="plant",e.prototype._hasSeeded=!1,e.prototype.getSize=function(){var t,e;return t=this.get("age"),this.species.defs.SPROUT_AGE&&t<this.species.defs.SPROUT_AGE?1:this.species.defs.MATURITY_AGE?(e=this.get("age")/this.species.defs.MATURITY_AGE,Math.min(e,1)):1},e.prototype.makeNewborn=function(){return e.__super__.makeNewborn.call(this),this.set("has flowers",!1)},e.prototype.createSeeds=function(){return this.get("num agents")>2?void 0:(this.reproduce(),this._hasSeeded=!0,this.set("has flowers",!1))},e.prototype.step=function(){var t,e,i;if(t=this.get("age"),i=this.get("season"),0!==t||"spring"===i){if(this._incrementAge(),this.get("is seed")){if(t<this.species.defs.SPROUT_AGE)return;this.set("is seed",!1)}return!this._hasSeeded&&this.species.defs.CAN_SEED&&(this.get("has flowers")||!(t>this.species.defs.MATURITY_AGE)||this.species.defs.IS_ANNUAL&&"fall"===i||Math.random()<this.get("chance of flowering")&&this.set("has flowers",!0),this.get("has flowers")&&(this.species.defs.IS_ANNUAL?"fall"===i&&Math.random()<this.species.defs.CHANCE_OF_SEEDING&&this.createSeeds():Math.random()<this.species.defs.CHANCE_OF_SEEDING&&this.createSeeds())),"winter"!==i||this.get("is immortal")||(e=this.get("health"),this.set("health",.5*e)),this._checkSurvival()}},e}(n)}),require.register("models/agents/fast-plant",function(t,e,i){var n,r,s,o,a={}.hasOwnProperty,h=function(t,e){function i(){this.constructor=t}for(var n in e)a.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};n=e("models/agent"),o=e("helpers"),s={"growth rate":.5,"min offspring":1,"max offspring":2,"max offspring distance":150,"food quantity":20},i.exports=r=function(t){function e(t){e.__super__.constructor.call(this,t),this._props=o.setDefaults(o.clone(s),this._props)}return h(e,t),e.prototype.label="plant",e.prototype._hasSeeded=!1,e.prototype.getSize=function(){return 1},e.prototype.makeNewborn=function(){return this.set("age",10),this.set("chance of survival",1),this.set("resource deficit",0)},e.prototype.step=function(){var t;return t=this.getEnvironmentProperty("food"),t>0&&ExtMath.randomFloat(1)<this.get("growth rate")&&this.reproduce(),this._checkSurvival()},e.prototype._checkSurvival=function(){var t;return t=this.get("chance of survival"),ExtMath.randomFloat(1)>t?this.die():void 0},e}(n)}),require.register("models/environment",function(t,e,i){var n,r,s,o,a,h,u,l,p,c,d,f={}.hasOwnProperty,g=function(t,e){function i(){this.constructor=t}for(var n in e)f.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};a=e("views/environment-view"),l=e("state-machine"),d=e("helpers"),h=e("events"),u=["spring","summer","fall","winter"],c={imgPath:"",winterImgPath:null,barriers:[],wrapEastWest:!1,wrapNorthSouth:!1,seasonLengths:[]},p={food:100,"food animals":100,"food full":100,"food low":30,"food regrowth rate":3},i.exports=o=function(t){function e(t){var i,r,o,h;t=d.setDefaults(t,c);for(r in t)this[r]=t[r];if(this.preload=[],null!=this.imgPath&&this.preload.push(this.imgPath),this.winterImgPath&&this.preload.push(this.winterImgPath),this.columns&&this.width)throw new Error("You can set columns and rows, or width and height, but not both");if(this.columns&&(this.width=this.columns*this._columnWidth,this.height=this.rows*this._rowHeight),this.width){if(this.width%this._columnWidth!==0)throw new Error("Width "+this.width+" is not evenly divisible by the column width "+this._columnWidth);if(this.height%this._rowHeight!==0)throw new Error("Height "+this.height+" is not evenly divisible by the row height "+this._rowHeight);this.columns=this.width/this._columnWidth,this.rows=this.height/this._rowHeight}for(this.cells=[],i=o=0,h=this.columns;h>=0?h>=o:o>=h;i=h>=0?++o:--o)this.cells[i]=[];this._setCellDefaults(),this._runLoopDelay=e.DEFAULT_RUN_LOOP_DELAY,this.setBarriers(this.barriers),this.agents=[],this._rules=[],this.carriedAgent=null,this._remapSeasonLengths(),this.season=u[0],this.date=0,this.addState(this.UI_STATE.NONE,s),this.addState(this.UI_STATE.ADD_AGENTS,n),this._view=new a({environment:this}),this.setState(this.UI_STATE.NONE)}return g(e,t),e.DEFAULT_RUN_LOOP_DELAY=54.5,e.prototype.addAgent=function(t){var i,n,r,s;return t.environment=this,r=this.ensureValidLocation(t.getLocation()),t.setLocation(r),this.isInBarrier(r.x,r.y)?!1:(n=Math.floor(r.x/this._columnWidth),s=Math.floor(r.y/this._rowHeight),i=this.get(n,s,"num agents"),null==i?this.set(n,s,"num agents",1):this.set(n,s,"num agents",i+1),-1===this.agents.indexOf(t)?(this.agents.push(t),h.dispatchEvent(e.EVENTS.AGENT_ADDED,{agent:t}),!0):!1)},e.prototype.removeAgent=function(t){var e,i,n,r;return n=t.getLocation(),i=Math.floor(n.x/this._columnWidth),r=Math.floor(n.y/this._rowHeight),e=this.get(i,r,"num agents"),null==e?this.set(i,r,"num agents",0):this.set(i,r,"num agents",e-1),this.agents.removeObj(t)?this.getView().removeAgent(t):void 0},e.prototype.removeDeadAgents=function(){var t,e,i;for(e=0,i=[];e<this.agents.length;)t=this.agents[e],i.push(t.isDead?this.removeAgent(t):e++);return i},e.prototype.agentsWithin=function(t){var e,i,n,s,o,a,h,u,l,p,c;if(h=t.x,u=t.y,a=t.width,s=t.height,null==h||null==u||null==a||null==s)throw new Error("Invalid rectangle definition!");for(i=new r(h,u,a,s),n=[],c=this.agents,l=0,p=c.length;p>l;l++)e=c[l],o=e.getLocation(),i.contains(o.x,o.y)&&n.push(e);return n},e.prototype.ensureValidLocation=function(t){var e,i;return e=t.x,i=t.y,e=this.wrapEastWest?this._wrapSingleDimension(e,this.width):this._bounceSingleDimension(e,this.width),i=this.wrapNorthSouth?this._wrapSingleDimension(i,this.height):this._bounceSingleDimension(i,this.height),{x:e,y:i}},e.prototype.randomLocation=function(){return this.randomLocationWithin(0,0,this.width,this.height)},e.prototype.randomLocationWithin=function(t,e,i,n,r){var s;for(null==r&&(r=!1),s={x:ExtMath.randomInt(i)+t,y:ExtMath.randomInt(n)+e};r&&this.isInBarrier(s);)s={x:ExtMath.randomInt(i)+t,y:ExtMath.randomInt(n)+e};return s},e.prototype.set=function(t,e,i,n){return this.cells[t][e]||(this.cells[t][e]={}),this.cells[t][e][i]=n},e.prototype.get=function(t,e,i){return null!=this[i]?this[i]:this.cells[t][e]?this.cells[t][e][i]:null},e.prototype.getAt=function(t,e,i){var n,r;return n=Math.floor(t/this._columnWidth),r=Math.floor(e/this._rowHeight),this.get(n,r,i)},e.prototype.setAt=function(t,e,i,n){var r,s;return r=Math.floor(t/this._columnWidth),s=Math.floor(e/this._rowHeight),this.set(r,s,i,n)},e.prototype.getAgentAt=function(t,e){var i,n,r,s;for(s=this.agents,n=0,r=s.length;r>n;n++)if(i=s[n],i.getView().contains(t,e))return i;return null},e.prototype.setBarriers=function(t){var e,i,n,r,s;for(i=t.slice(),this.barriers=[],s=i||[],n=0,r=s.length;r>n;n++)e=s[n],this.addBarrier.apply(this,e);return this._view&&null!=this._view.barrierGraphics?this._view.rerenderBarriers():void 0},e.prototype.addBarrier=function(t,e,i,n){return this.barriers.push(new r(t,e,i,n))},e.prototype.crossesBarrier=function(t,e){var i,n,r,s,o,a,h,u;if(!this.wrapEastWest&&(0>e.x||e.x>this.width)||!this.wrapNorthSouth&&(0>e.y||e.y>this.height))return!0;for(n=e.x-t.x,r=e.y-t.y,0!==n?(o=r/n,s=function(e,i){return o*(e-t.x)+t.y-i}):s=function(e){return e-t.x},u=this.barriers,a=0,h=u.length;h>a;a++){if(i=u[a],i.contains(e.x,e.y))return!0;if(!(t.x>i.x2&&e.x>i.x2||t.x<i.x1&&e.x<i.x1||t.y>i.y2&&e.y>i.y2||t.y<i.y1&&e.y<i.y1)&&i.intersectsLine(s))return!0}return!1},e.prototype.setSeasonLength=function(t,e){var i;switch(i=-1,t){case"spring":case 0:i=0;break;case"summer":case 1:i=1;break;case"fall":case 2:i=2;break;case"winter":case 3:i=3;break;default:throw new Error("Invalid season '"+t+"'")}return this.seasonLengths[i]=e,this._remapSeasonLengths()},e.prototype.isInBarrier=function(t,e){var i,n,r,s;for(s=this.barriers,n=0,r=s.length;r>n;n++)if(i=s[n],i.contains(t,e))return!0;return!1},e.prototype.pickUpAgent=function(t){return this.removeAgent(t),this.carriedAgent=t},e.prototype.dropCarriedAgent=function(){return this.addAgent(this.carriedAgent)||(this.carriedAgent.setLocation(this._agentOrigin),this.addAgent(this.carriedAgent)),this.getView().removeCarriedAgent(this.carriedAgent),this.carriedAgent=null},e.prototype.setDefaultAgentCreator=function(t,e,i){return this.defaultSpecies=t,this.defaultTraits=e,void(this.agentAdderCallback=i)},e.prototype.addDefaultAgent=function(t,e){var i,n;if(null!=this.defaultSpecies)return i=this.defaultSpecies.createAgent(this.defaultTraits),i.environment=this,i.setLocation({x:t,y:e}),n=this.addAgent(i),n&&this.agentAdderCallback?this.agentAdderCallback():void 0},e.prototype.setSpeed=function(t){var e,i;return this._speed=t,i=-1/((t-141)/4e3)-27.3,e=1e3/i,this._runLoopDelay=e},e.prototype.start=function(){var t,i=this;return this._isRunning=!0,t=function(){return setTimeout(function(){return i.step(),i._isRunning?t():void 0},i._runLoopDelay)},t(),h.dispatchEvent(e.EVENTS.START,{})},e.prototype.stop=function(){return this._isRunning=!1,h.dispatchEvent(e.EVENTS.STOP,{})},e.prototype.step=function(){var t,i,n,r,s,o,a,u,l,p,c;for(this._incrementDate(),l=this._rules,n=0,o=l.length;o>n;n++)for(i=l[n],p=this.agents,r=0,a=p.length;a>r;r++)t=p[r],i.execute(t);for(c=this.agents,s=0,u=c.length;u>s;s++)t=c[s],null!=t._consumeResources&&t._consumeResources(),t.step();return this._replenishResources(),this.removeDeadAgents(),h.dispatchEvent(e.EVENTS.STEP,{})},e.prototype.reset=function(){var t;for(this.stop(),t=this.agents.length;t;)this.removeAgent(this.agents[--t]);
return this.date=0,h.dispatchEvent(e.EVENTS.RESET,{})},e.prototype._columnWidth=10,e.prototype._rowHeight=10,e.prototype._rules=null,e.prototype._speed=50,e.prototype._runLoopDelay=54.5,e.prototype._isRunning=!1,e.prototype.getView=function(){return this._view},e.prototype.addRule=function(t){return this._rules||(this._rules=[]),-1===this._rules.indexOf(t)?this._rules.push(t):void 0},e.prototype.removeRule=function(t){return this._rules||(this._rules=[]),this._rules.removeObj(t)},e.prototype.clearRules=function(){return this._rules=[]},e.prototype.setBackground=function(t){return this.imgPath=t,this._view.updateBackground()},e.prototype._incrementDate=function(){var t,i,n,r,s,o;if(this.date++,this.usingSeasons&&4===this._totalSeasonLengths.length){for(n=this.date%this.yearLength,o=this._totalSeasonLengths,t=r=0,s=o.length;s>r;t=++r)if(i=o[t],i>n){this.season!==u[t]&&(this.season=u[t],h.dispatchEvent(e.EVENTS.SEASON_CHANGED,{season:this.season}));break}if(n===this._totalSeasonLengths[2])return this._view.addWinterImage();if(n===this._totalSeasonLengths[3]-1)return this._view.removeWinterImage()}},e.prototype._replenishResources=function(){var t,e,i,n,r,s,o,a,h;for(h=[],r=o=0,a=this.columns;a>=0?a>=o:o>=a;r=a>=0?++o:--o)h.push(function(){var o,a,h;for(h=[],s=o=0,a=this.rows;a>=0?a>=o:o>=a;s=a>=0?++o:--o)t=this.cells[r][s],i=t["food regrowth rate"],n=t["food full"],e=t.food,n>e&&(t.food=Math.min(n,e+i)),e=t["food animals"],h.push(n>e?t["food animals"]=Math.min(n,e+i):void 0);return h}.call(this));return h},e.prototype._wrapSingleDimension=function(t,e){return 0>t?t=e+t:t>=e&&(t-=e),t},e.prototype._bounceSingleDimension=function(t,e){return 0>t?t=-1*t:t>=e&&(t=e-(t-e)-1),t},e.prototype._remapSeasonLengths=function(){var t,e,i,n,r;for(this._totalSeasonLengths=[],r=this.seasonLengths,t=i=0,n=r.length;n>i;t=++i)e=r[t],this._totalSeasonLengths[t]=e+(this._totalSeasonLengths[t-1]||0);return this.usingSeasons=this._totalSeasonLengths.length>0,this.yearLength=this._totalSeasonLengths[3]||0},e.prototype._setCellDefaults=function(){var t,e,i,n,r;for(r=[],t=i=0,n=this.columns;n>=0?n>=i:i>=n;t=n>=0?++i:--i)r.push(function(){var i,n,r;for(r=[],e=i=0,n=this.rows;n>=0?n>=i:i>=n;e=n>=0?++i:--i)r.push(this.cells[t][e]=d.clone(p));return r}.call(this));return r},e.EVENTS={START:"environment-start",STOP:"environment-stop",STEP:"environment-step",RESET:"environment-reset",AGENT_ADDED:"agent-added",AGENT_EATEN:"agent-eaten",SEASON_CHANGED:"season-changed",USER_REMOVED_AGENTS:"user-removed-agents"},e.prototype.UI_STATE={NONE:"None",ADD_AGENTS:"Add Agents"},e}(l),r=function(){function t(t,e,i,n){this.x1=t,this.y1=e,this.x2=this.x1+i,this.y2=this.y1+n,this.corners=[],this.corners.push({x:this.x1,y:this.y1}),this.corners.push({x:this.x1,y:this.y2}),this.corners.push({x:this.x2,y:this.y1}),this.corners.push({x:this.x2,y:this.y2})}return t.prototype.contains=function(t,e){return this.x2>=t&&t>=this.x1&&this.y2>=e&&e>=this.y1},t.prototype.intersectsLine=function(t){var e,i,n,r,s,o,a;for(n=null,a=this.corners,s=0,o=a.length;o>s;s++){if(e=a[s],i=t(e.x,e.y),0===i)return!0;if(r=0>i?-1:1,null==n)n=r;else if(r!==n)return!0}return!1},t}(),s={enter:function(){return this._view.setCursor("default-cursor")}},n={enter:function(){return this._view.setCursor("add-agents")},click:function(t){return this.addDefaultAgent(t.envX,t.envY)}}}),require.register("models/inanimate",function(t,e,i){var n,r,s,o={}.hasOwnProperty,a=function(t,e){function i(){this.constructor=t}for(var n in e)o.call(e,n)&&(t[n]=e[n]);return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t};n=e("models/agent"),i.exports=r=function(t){function e(){return s=e.__super__.constructor.apply(this,arguments)}return a(e,t),e.prototype.label="inanimate",e.prototype._viewLayer=0,e.prototype.step=function(){return void 0},e.prototype._consumeResources=null,e}(n)}),require.register("models/rule",function(t,e,i){var n;i.exports=n=function(){function t(t){var e,i;if(i=t.test,e=t.action,null==e||"function"!=typeof e)throw new Error("action is not a function!");this._test=i,this._action=e}return t.prototype.execute=function(t){var e;try{if(null==this._test||this._test(t))return this._action(t)}catch(i){return e=i,console.log("Error executing rule!"+e)}},t}()}),require.register("models/species",function(t,e,i){var n,r,s;s=e("helpers"),r={MAX_AGE:1e3,MAX_HEALTH:1,CHANCE_OF_MUTATION:.2},i.exports=n=function(){function t(t){this.speciesName=t.speciesName,this.individualName=t.individualName,this.agentClass=t.agentClass,this.traits=t.traits,this.viewLayer=t.viewLayer,this.imageProperties=t.imageProperties,this.imageRules=t.imageRules,this.defs=t.defs,this.reproductiveStrategy=t.reproductiveStrategy,this.geneticSpecies=t.geneticSpecies,this.mutationChance=t.mutationChance,this.defs=s.setDefaults(this.defs||{},r),this._parsePreloads()}return t.prototype.createAgent=function(t){var e,i,n,r,s,o,a;for(null==t&&(t=[]),e=new this.agentClass({species:this}),a=this.traits,n=0,s=a.length;s>n;n++)i=a[n],i.isGenetic?e.alleles[i.name]=i.getDefaultValue():e.set(i.name,i.getDefaultValue());for(r=0,o=t.length;o>r;r++)i=t[r],i.isGenetic?e.alleles[i.name]=i.getDefaultValue():e.set(i.name,i.getDefaultValue());return e.resetGeneticTraits(),e},t.prototype.getImages=function(t,e){var i,n,r,s,o,a,h,u,l;for(null==e&&(e={}),n=[],u=this.imageRules,s=0,a=u.length;a>s;s++)if(r=u[s],this._contextMatches(e.context,r.contexts)){for(r.selectedImage=null,l=r.rules,o=0,h=l.length;h>o;o++)if(i=l[o],null==i.useIf||i.useIf.call(this,t)){r.selectedImage=i.image;break}null!=r.selectedImage&&n.push(r)}return n},t.prototype.getTrait=function(t){var e,i,n,r;for(r=this.traits,i=0,n=r.length;n>i;i++)if(e=r[i],e.name===t)return e;return null},t.prototype.addTrait=function(t){return this.traits.push(t)},t.prototype.setMutatable=function(t,e){var i;return i=this.getTrait(t),null!=i?i.mutatable=e:void 0},t.prototype._contextMatches=function(t,e){return null==t?!0:null!=e&&e.length>0?-1!==e.indexOf(t):!0},t.prototype._parsePreloads=function(){var t,e,i,n,r,s,o;if(this.preload=[],null!=this.imageRules){for(s=this.imageRules,o=[],n=0,r=s.length;r>n;n++)i=s[n],null!=i.rules&&o.push(function(){var n,r,s,o,a,h;for(s=i.rules,h=[],n=0,r=s.length;r>n;n++)e=s[n],null!=(null!=(o=e.image)?o.path:void 0)&&this.preload.push(e.image.path),null!=(null!=(a=e.image)?a.animations:void 0)&&h.push(function(){var i,n,r,s;for(r=e.image.animations,s=[],i=0,n=r.length;n>i;i++)t=r[i],s.push(null!=t.path?this.preload.push(t.path):void 0);return s}.call(this));return h}.call(this));return o}},t}()}),require.register("models/trait",function(t,e,i){var n;e("helpers"),i.exports=n=function(){function t(t){this.name=t.name,this.possibleValues=t.possibleValues,this.min=t.min,this.max=t.max,this["default"]=t["default"],this["float"]=t["float"],this.mutatable=t.mutatable,this.isGenetic=t.isGenetic,this.isNumeric=t.isNumeric}return t.prototype.getDefaultValue=function(){return null!=this["default"]?this["default"]:this.getRandomValue()},t.prototype.getRandomValue=function(){return this.possibleValues?this.possibleValues.randomElement():this["float"]?ExtMath.randomValue(this.min,this.max):Math.floor(ExtMath.randomValue(this.min,this.max+1))},t.prototype.mutate=function(t){var e;if(!this.mutatable)return t;if(this.possibleValues&&this.possibleValues.length>1){for(;;)if(e=this.getRandomValue(),e!==t)break;return e}return this.max?this._mutateValueFromRange(t):t},t.prototype.isPossibleValue=function(t){return-1!==this.possibleValues.indexOf(t)},t.prototype.inherit=function(t,e){var i;return i=null,this.isGenetic||(null!=this.possibleValues?i=0===ExtMath.flip()?t:e:this["float"]?i=ExtMath.randomValue(t,e):(t>e?t+=1:e+=1,i=Math.floor(ExtMath.randomValue(t,e)))),i},t.prototype._mutateValueFromRange=function(t){var e,i;return i=ExtMath.flip()?1:-1,e=this["float"]?.1:1,t+=e*i,t=Math.max(t,this.min),t=Math.min(t,this.max)},t}()}),require.register("state-machine",function(t,e,i){var n;i.exports=n=function(){function t(){}return t.prototype._states=null,t.prototype.addState=function(t,e){return null==this._states&&(this._states=[]),this._states[t]=e},t.prototype.setState=function(t){if(null==this._states[t])throw new Error("No such state: "+t);return this.currentState=t,null!=this._states[this.currentState].enter?this._states[this.currentState].enter.apply(this):void 0},t.prototype.send=function(t,e){if(null==this.currentState)throw new Error("No current state exists to handle '"+t+"'");return null!=this._states[this.currentState][t]?this._states[this.currentState][t].apply(this,[e]):"touchstart"===t&&null!=this._states[this.currentState].click?(e.preventDefault(),this._states[this.currentState].click.apply(this,[e])):void 0},t}()}),require.register("ui/add-organism-button",function(t,e,i){var n;i.exports=n=function(){function t(t,e,i){this.environment=t,this.toolbar=e,this.species=i.species,this.traits=i.traits,this.scatter=i.scatter,this.limit=i.limit,this.imagePath=i.imagePath,this.showRemoveButton=i.showRemoveButton,this.scatter||this.toolbar.registerModalButton(this)}return t.prototype.render=function(){var t,e=this;return this.button=document.createElement("div"),this.button.classList.add("button"),this.showRemoveButton&&this.button.classList.add("has-no-button"),this.button.addEventListener("click",function(){return e.action()}),this.scatter||this.button.classList.add("modal"),t=document.createElement("img"),t.setAttribute("src",this.imagePath),this.button.appendChild(t),this.button},t.prototype.getView=function(){return this.button},t.prototype._count=0,t.prototype._disabled=!1,t.prototype.disable=function(){return this._disabled=!0,this.button.classList.add("disabled")},t.prototype.reset=function(){return this._count=0,this._disabled=!1,this.button.classList.remove("disabled")},t.prototype.action=function(){return this._disabled?void 0:this.scatter?this.scatterOrganisms():this.enterAddOrganismsMode()},t.prototype.scatterOrganisms=function(){var t,e,i,n;for(e=i=0,n=this.scatter;n>=0?n>i:i>n;e=n>=0?++i:--i){if(this.limit&&++this._count>=this.limit&&(this.disable(),this._count>this.limit))return;for(t=this.species.createAgent(this.traits),t.environment=this.environment,t.setLocation(this.environment.randomLocation());!this.environment.addAgent(t);)t.setLocation(this.environment.randomLocation())}},t.prototype.enterAddOrganismsMode=function(){var t=this;return this.toolbar.activateModalButton(this),this.environment.setDefaultAgentCreator(this.species,this.traits,function(){return t.limit&&++t._count>=t.limit?(t.environment.setDefaultAgentCreator(null),t.environment.setState(t.environment.UI_STATE.NONE),t.disable()):void 0}),this.environment.setState(this.environment.UI_STATE.ADD_AGENTS)},t}()}),require.register("ui/info-view",function(t,e,i){var n;i.exports=n=function(){function t(e){this.agent=e.agent,t._instances.push(this)}return t._instances=[],t.instances=function(){return t._instances},t.prototype.view=null,t.prototype.setAgent=function(t){for(this.agent=t;this._container.children.length>0;)this._container.removeChild(this._container.children[0]);return this.agent.getView().render(this._container,"info-tool"),this._repositionAgent(),this._rescaleAgent(),null!=this._details.firstChild?this._details.replaceChild(this.agent.getView().textView(),this._details.firstChild):this._details.appendChild(this.agent.getView().textView()),this.title.innerHTML=this.agent.label.charAt(0).toUpperCase()+this.agent.label.slice(1)},t.prototype._repositionAgent=function(){return this._container.children[0].position={x:0,y:0},this._container.position={x:52,y:70}},t.prototype._rescaleAgent=function(){return null!=this.agent.species.defs.INFO_VIEW_SCALE?(this._container.scale.x=this.agent.species.defs.INFO_VIEW_SCALE,this._container.scale.y=this.agent.species.defs.INFO_VIEW_SCALE):(this._container.scale.x=1.25,this._container.scale.y=1.25)},t.prototype._redraw=function(){var t=this;return this._showing&&requestAnimFrame(function(){return t._redraw()}),this._renderer.render(this._stage)},t.prototype.render=function(){var t,e,i,n,r=this;return this.view=document.createElement("div"),this.view.classList.add("bubble"),this.view.classList.add(this.agent._x<this.agent.environment.width/2?"left":"right"),this.view.classList.add(this.agent._y<this.agent.environment.height/2?"top":"bottom"),n=document.createElement("div"),n.classList.add("title-bar"),this.title=document.createElement("span"),this.title.classList.add("title"),this.title.innerHTML=this.agent.label.charAt(0).toUpperCase()+this.agent.label.slice(1),e=document.createElement("span"),e.classList.add("close"),e.innerHTML="<i class='fa fa-times-circle-o'></i>",e.addEventListener("click",function(){return r.hide()}),i=document.createElement("div"),i.classList.add("content"),this._details=document.createElement("div"),this._details.classList.add("details"),t=document.createElement("div"),t.classList.add("agent"),this._stage=new PIXI.Stage(16777215,!0),this._renderer=new PIXI.CanvasRenderer(125,160),this._container=new PIXI.DisplayObjectContainer,this._stage.addChild(this._container),this.setAgent(this.agent),this._redraw(),t.appendChild(this._renderer.view),n.appendChild(this.title),n.appendChild(e),i.appendChild(t),i.appendChild(this._details),this.view.appendChild(n),this.view.appendChild(i),this.view},t.prototype.hide=function(){return this.view.classList.contains("hidden")||this.view.classList.add("hidden"),this._showing=!1},t.prototype.show=function(){return this.view.classList.remove("hidden"),this._showing=!0,this._redraw()},t.prototype.repaint=function(){return this._renderer.render(this._stage)},t}()}),require.register("ui/interactive",function(t,e,i){var n,r,s,o,a,h,u,l;l=e("helpers"),h=e("ui/toolbar"),s=e("ui/info-view"),a=e("ui/speed-slider"),r=e("events"),n=e("models/environment"),u={environment:null,playButton:!0,resetButton:!0,speedSlider:!1,addOrganismButtons:[],toolButtons:[]},i.exports=o=function(){function t(t){var e,i,s=this;this._opts=l.setDefaults(t,u),this.environment=this._opts.environment,this.addOrganismButtons=this._opts.addOrganismButtons,this.toolButtons=this._opts.toolButtons,"undefined"!=typeof Shutterbug&&null!==Shutterbug&&(window.shutterbug=new Shutterbug("body"),$(window).on("shutterbug-saycheese",function(){return s.repaint()})),"undefined"!=typeof iframePhone&&null!==iframePhone&&(i=iframePhone.getIFrameEndpoint(),e=!1,i.addListener("stop",function(){return e=!0,s.stop(),e=!1}),i.addListener("play",function(){return e=!0,s.play(),e=!1}),i.addListener("reset",function(){return e=!0,s.reset(),e=!1}),r.addEventListener(n.EVENTS.START,function(){return e?void 0:i.post({type:"play"})}),r.addEventListener(n.EVENTS.STOP,function(){return e?void 0:i.post({type:"stop"})}),r.addEventListener(n.EVENTS.RESET,function(){return e?void 0:i.post({type:"reset"})}),i.initialize())}return t.prototype.getEnvironmentPane=function(){var t;return this.view=document.createElement("div"),this.view.setAttribute("style","height: "+this.environment.height+"px;"),this._opts.speedSlider&&(t=new a(this.environment),this.view.appendChild(t.getView())),this.view.appendChild(this.environment.getView().render()),this.toolbar=new h(this),this.view.appendChild(this.toolbar.getView()),this.view},t.prototype.showPlayButton=function(){return this._opts.playButton},t.prototype.showResetButton=function(){return this._opts.resetButton},t.prototype.repaint=function(){var t,e,i,n;for(n=s.instances(),e=0,i=n.length;i>e;e++)t=n[e],t.repaint();return this.environment.getView().repaint()},t.prototype.play=function(){return this.environment._isRunning?void 0:this.toolbar.toggleButtons.play.click()},t.prototype.stop=function(){return this.environment._isRunning?this.toolbar.toggleButtons.pause.click():void 0},t.prototype.reset=function(){return this.toolbar.toggleButtons.reset.click()},t}(),window.onerror=function(t,e,i){var n;return n="<div>There was an error in the model!<br/><pre>"+t+"</pre></div>",n+="<div>source: "+e+", line: "+i+"</div>",l.showMessage(n,document.body)}}),require.register("ui/ppslider",function(t,e,i){var n;!function(t){return n=function(e,i){var n,r;if("undefined"==typeof t||null==t)return void console.warn("jQuery not loaded! PPSlider is not supported");var s=t(e),o=i,a=!1,h=0;s.wrap("<div/>");var u=t(e).parent();u.addClass("pp-slider"),i.vertical&&u.addClass("vertical"),u.addClass("clearfix");var l='<div class="pp-slider-min">'+i.minLabel+"</div>",p='<div class="pp-slider-max">'+i.maxLabel+"</div>",c="";c+=i.vertical?p:l,c+='<div class="pp-slider-scale">',c+='<div class="pp-slider-button',o.moveable&&(c+=" moveable"),c+='"><div class="pp-slider-divies"></div></div>',c+='<div class="pp-slider-tooltip"></div>',c+="</div>",c+=i.vertical?l:p,u.append(c),"undefined"!=typeof o&&"undefined"!=typeof o.hideTooltip&&1==o.hideTooltip&&(u.find(".pp-slider-tooltip").hide(),u.addClass("noTooltip")),"undefined"!=typeof o.width&&u.css("width",o.width+"px"),"undefined"!=typeof o.height&&u.css("height",o.height+"px"),i.vertical?u.find(".pp-slider-scale").css("height",u.height()-30+"px"):u.find(".pp-slider-scale").css("width",u.width()-30+"px");var d=function(e){if(!o.moveable)return!0;e.originalEvent&&e.originalEvent instanceof TouchEvent&&e.preventDefault(),a=!0;var i=f(e);return o.vertical?(n=i.y,r=t(this).offset().top-t(this).parent().offset().top):(n=i.x,r=t(this).offset().left-t(this).parent().offset().left),m(e),!1},f=function(t){var e=0,i=0;if(!t)var t=window.event;return t.originalEvent&&t.originalEvent instanceof TouchEvent?(e=t.originalEvent.changedTouches[0].pageX,i=t.originalEvent.changedTouches[0].pageY):t.pageX||t.pageY?(e=t.pageX,i=t.pageY):(t.clientX||t.clientY)&&(e=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),{x:e,y:i}},g=function(t,e){o.vertical?(u.find(".pp-slider-button").css("top",t),u.find(".pp-slider-tooltip").html(e+"%"),u.find(".pp-slider-tooltip").css("top",t-6)):(u.find(".pp-slider-button").css("left",t),u.find(".pp-slider-tooltip").html(e+"%"),u.find(".pp-slider-tooltip").css("left",t-6))},m=function(t){var e,i,s=f(t);if(o.vertical){var a=s.y-n;e=r+a,i=u.find(".pp-slider-scale").height()-u.find(".pp-slider-button").height()}else{var l=s.x-n;e=r+l,i=u.find(".pp-slider-scale").width()-u.find(".pp-slider-button").width()}e=Math.max(0,e),e=Math.min(e,i),h=Math.round(e/i*100,0),o.vertical&&(h=100-h),g(e,h)},v=function(t){h=t;var e,i;o.vertical?(e=u.find(".pp-slider-scale").height()-u.find(".pp-slider-button").height(),i=(100-t)/100*e):(e=u.find(".pp-slider-scale").width()-u.find(".pp-slider-button").width(),i=t/100*e),g(i,t)},y=function(t){return a?(t.originalEvent&&t.originalEvent instanceof TouchEvent&&t.preventDefault(),m(t),!1):void 0},_=function(t){a&&(t.originalEvent&&t.originalEvent instanceof TouchEvent&&t.preventDefault(),a=!1,s.val(h),s.trigger("change"))};return v(s.val()),u.find(".pp-slider-button").bind("mousedown",d),u.find(".pp-slider-button").bind("touchstart",d),t(document).mousemove(function(t){y(t)}),t(document).on("touchmove",function(t){y(t)}),t(document).mouseup(function(t){_(t)}),t(document).on("touchend",function(t){_(t)}),{updatePositionByValue:v}},"undefined"==typeof t||null==t?void console.warn("jQuery not loaded! PPSlider is not supported"):(t.fn.PPSlider=function(e){var i,r=t.extend({},t.fn.PPSlider.defaults,e);return this.each(function(){i=new n(t(this),r)}),i},void(t.fn.PPSlider.defaults={minLabel:"-",maxLabel:"+",moveable:!0,vertical:!1,hideTooltip:!0}))}(jQuery),i.exports=n}),require.register("ui/remove-organism-button",function(t,e,i){var n,r,s;r=e("events"),n=e("models/environment"),i.exports=s=function(){function t(t,e,i){this.environment=t,this.toolbar=e,this.species=i.species,this.imagePath=i.imagePath}return t.prototype.render=function(){var t,e,i=this;return this.button=document.createElement("div"),this.button.classList.add("button"),this.button.classList.add("no-button"),this.button.addEventListener("click",function(){return i.action()}),t=document.createElement("img"),t.setAttribute("src",this.imagePath),this.button.appendChild(t),e=document.createElement("div"),e.classList.add("no-sign"),this.button.appendChild(e),this.button},t.prototype.getView=function(){return this.button},t.prototype._disabled=!1,t.prototype.disable=function(){return this._disabled=!0,this.button.classList.add("disabled")},t.prototype.reset=function(){return this._disabled=!1,this.button.classList.remove("disabled")},t.prototype.action=function(){return this._disabled?void 0:(this.removeOrganisms(),r.dispatchEvent(n.EVENTS.USER_REMOVED_AGENTS,{species:this.species}))},t.prototype.removeOrganisms=function(){var t,e,i,n;for(n=this.environment.agents,e=0,i=n.length;i>e;e++)t=n[e],t.species===this.species&&t.die();return this.environment.removeDeadAgents()},t}()}),require.register("ui/speed-slider",function(t,e,i){var n,r;n=e("ui/ppslider"),i.exports=r=function(){function t(t){var e;this.view=document.createElement("div"),this.view.setAttribute("style","height: 20px;"),e=document.createElement("input"),e.setAttribute("id","speed-slider"),e.setAttribute("type","hidden"),e.setAttribute("value",50),this.view.appendChild(e),$(document).ready(function(){return $(e).change(function(){return t.setSpeed(parseInt($(this).val()))}),$(e).PPSlider({width:t.width})})}return t.prototype.getView=function(){return this.view},t}()}),require.register("ui/tool-button",function(t,e,i){var n,r;n=e("ui/info-view"),i.exports=r=function(){function t(t,e,i){this.environment=t,this.toolbar=e,this.type=i.type,this.toolbar.registerModalButton(this),this.state=this._getState(),this.environment.addState(this.type,this.state)}return t.INFO_TOOL="info-tool",t.CARRY_TOOL="carry-tool",t.prototype.state=null,t.prototype.render=function(){var t,e=this;return this.button=document.createElement("div"),this.button.classList.add("button"),this.button.addEventListener("click",function(){return e.action()}),this.button.classList.add("modal"),t=document.createElement("div"),t.classList.add(this.type),this.button.appendChild(t),this.button},t.prototype.getView=function(){return this.button},t.prototype.action=function(){return this.toolbar.activateModalButton(this),this.environment.setState(this.type)},t.prototype._getState=function(){return this._states[this.type]},t.prototype._states={"info-tool":{enter:function(){return this._view.setCursor("info-tool")},click:function(t){var e,i,r,s,o;if(e=this.getAgentAt(t.envX,t.envY),null!=e){for(null!=this.infoPopup?this.infoPopup.setAgent(e):(this.infoPopup=new n({agent:e}),document.getElementById("environment").appendChild(this.infoPopup.render())),o=["top","left","bottom","right"],r=0,s=o.length;s>r;r++)i=o[r],this.infoPopup.view.classList.remove(i);return t.envX>this.width/2?(this.infoPopup.view.classList.add("right"),this.infoPopup.view.style.left=t.envX-225+"px"):(this.infoPopup.view.classList.add("left"),this.infoPopup.view.style.left=t.envX+35+"px"),t.envY>this.height/2?(this.infoPopup.view.classList.add("bottom"),this.infoPopup.view.style.top=t.envY-162+"px"):(this.infoPopup.view.classList.add("top"),this.infoPopup.view.style.top=t.envY-25+"px"),this.infoPopup.show()}}},"carry-tool":{_agent:null,_origin:null,_agentOrigin:null,enter:function(){return this._view.setCursor("carry-tool")},mousedown:function(t){var e;return e=this.getAgentAt(t.envX,t.envY),null!=e?(this.pickUpAgent(e),this._agent=e,this._origin={x:t.envX,y:t.envY},this._agentOrigin=e.getLocation()):void 0},mousemove:function(t){var e,i;if(null!=this._agent)return e=t.envX-this._origin.x,i=t.envY-this._origin.y,this._agent.setLocation({x:this._agentOrigin.x+e,y:this._agentOrigin.y+i})},mouseup:function(){return null!=this._agent?(this.dropCarriedAgent(),this._agent=null):void 0},touchstart:function(t){return t.preventDefault(),this.send("mousedown",t)},touchmove:function(t){return t.preventDefault(),this.send("mousemove",t)},touchend:function(t){return t.preventDefault(),this.send("mouseup",t)}}},t}()}),require.register("ui/toolbar",function(t,e,i){var n,r,s,o,a,h;n=e("ui/add-organism-button"),o=e("ui/remove-organism-button"),a=e("ui/tool-button"),s=e("events"),r=e("models/environment"),i.exports=h=function(){function t(t){var e,i,h,u,l,p,c,d,f,g,m=this;for(this.interactive=t,i=this.interactive.environment,this.modalButtons=[],this.toggleButtons=[],this.organismButtons=[],this.view=document.createElement("div"),this.view.classList.add("toolbar"),this.view.setAttribute("style","height: "+i.height+"px;"),this.interactive.showPlayButton()&&(this.addToggleButton("play",function(){return i.start()},"pause",function(){return i.stop()}),s.addEventListener(r.EVENTS.PLAY,function(){return m.toggleButtons.play.style.display="none",m.toggleButtons.pause.style.display=""}),s.addEventListener(r.EVENTS.STOP,function(){return m.toggleButtons.play.style.display="",m.toggleButtons.pause.style.display="none"})),f=this.interactive.addOrganismButtons,l=0,c=f.length;c>l;l++)h=f[l],e=new n(i,this,h),this.view.appendChild(e.render()),this.organismButtons.push(e),h.showRemoveButton&&(u=new o(i,this,h),this.view.appendChild(u.render()),this.organismButtons.push(u));for(g=this.interactive.toolButtons,p=0,d=g.length;d>p;p++)h=g[p],e=new a(i,this,h),this.view.appendChild(e.render());this.interactive.showResetButton()&&this.addButton("reset",function(){return m.reset(),i.reset()})}return t.prototype.addButton=function(t,e){var i,n;return i=document.createElement("div"),i.classList.add("button"),n=document.createElement("div"),n.classList.add(t),i.appendChild(n),i.addEventListener("click",e),this.toggleButtons[t]=i,this.view.appendChild(i)},t.prototype.addToggleButton=function(t,e,i,n){var r,s;return r=this.addButton(t,e),s=this.addButton(i,n),s.style.display="none",r.addEventListener("click",function(){return r.style.display="none",s.style.display=""}),s.addEventListener("click",function(){return r.style.display="",s.style.display="none"})},t.prototype.registerModalButton=function(t){return this.modalButtons.push(t)},t.prototype.activateModalButton=function(t){var e,i,n,r,s;for(t.getView().classList.add("modal-active"),r=this.modalButtons,s=[],i=0,n=r.length;n>i;i++)e=r[i],s.push(e!==t?e.getView().classList.remove("modal-active"):void 0);return s},t.prototype.reset=function(){var t,e,i,n,r,s,o,a;for(o=this.modalButtons,i=0,r=o.length;r>i;i++)t=o[i],t.getView().classList.remove("modal-active");for(a=this.organismButtons,n=0,s=a.length;s>n;n++)t=a[n],t.reset();return e=this.interactive.environment,e.setState(e.UI_STATE.NONE)},t.prototype.getView=function(){return this.view},t}()}),require.register("views/agent-view",function(t,e,i){var n,r,s={}.hasOwnProperty;r=e("helpers"),e("animated-sprite"),i.exports=n=function(){function t(t){var e;this.agent=t.agent,this.imageProperties=(null!=(e=this.agent.species)?e.imageProperties:void 0)||{}}return t.prototype._images=null,t.prototype._sprites=null,t.prototype._container=null,t.prototype.render=function(t,e){var i,n,r,s,o,a,h;for(null==e&&(e="environment"),i=new PIXI.DisplayObjectContainer,o={},n=this.agent.getImages({context:e}),a=0,h=n.length;h>a;a++)r=n[a],s=this._createSprite(r.selectedImage,r.name),this._setSpriteProperties(s,r.selectedImage),o[r.name]=s,i.addChild(s);return i.position.x=this.agent._x,i.position.y=this.agent._y,t.addChild(i),"environment"===e||"carry-tool"===e?(this._rendered=!0,this._container=i,this._sprites=o,this._images=n):void 0},t.prototype.rerender=function(t,e){var i,n,r,o,a,h,u,l,p,c,d,f,g;if(null==e&&(e="environment"),!this._rendered)return void this.render(t,e);for(a=this.agent.getImages({context:e}),o=[],i=p=0,d=a.length;d>p;i=++p)n=a[i],o.push(n.name),null==this._sprites[n.name]?(u=this._createSprite(n.selectedImage),this._sprites[n.name]=u,this._container.addChildAt(u,i)):null!=n.selectedImage.path&&n.selectedImage.path!==this._sprites[n.name].texture.baseTexture.source.src&&(l=PIXI.Texture.fromImage(n.selectedImage.path),u=this._sprites[n.name],u.setTexture(l)),this._setSpriteProperties(this._sprites[n.name],n.selectedImage);g=this._sprites;for(r in g)s.call(g,r)&&(u=g[r],-1===o.indexOf(r)&&(this._container.removeChild(u),delete this._sprites[r]));for(this._container.position.x=this.agent._x,this._container.position.y=this.agent._y,i=c=0,f=a.length;f>c;i=++c)if(n=a[i],null!=(u=this._sprites[n.name])&&u instanceof PIXI.AnimatedSprite){if(window.sprite=u,h=this.agent.getMovement(),!h)return;h!==u.currentSequence&&(u.playing?u.nextSequence=h:u.gotoAndPlay(h)),u.advanceTime()}},t.prototype.remove=function(t){var e;try{this._rendered&&null!=t&&t.removeChild(this._container)}catch(i){e=i,console.error("Tried to remove an agent from a stage it wasn't rendered within.")}return this._rendered=!1},t.prototype.contains=function(t,e){var i;return i=new PIXI.InteractionManager,i.hitTest(this._container,{global:{x:t,y:e}})},t.prototype.defaultTextViewOptions={leaves:!0,roots:!0},t.prototype.textView=function(t){var e,i,n,o,a;if(null==t&&(t={}),n=r.setDefaults(t,this.defaultTextViewOptions),e=document.createElement("div"),null!=this.agent.species.defs.INFO_VIEW_PROPERTIES){a=this.agent.species.defs.INFO_VIEW_PROPERTIES;for(i in a)s.call(a,i)&&(o=a[i],this._appendPropVals(e,i,o))}return e},t.prototype._appendPropVals=function(t,e,i){var n,r;return n=document.createElement("div"),n.classList.add("agent-property"),n.innerHTML=e,r=document.createElement("div"),r.classList.add("agent-property-value"),r.innerHTML=this.agent.get(i),t.appendChild(n),t.appendChild(r),t},t.prototype._createSprite=function(t){var e,i,n,r,s,o,a,h,u,l,p;if(t.animations)for(r=null,l=t.animations,a=0,u=l.length;u>a;a++){for(e=l[a],s=[],i=h=0,p=e.length;p>=0?p>h:h>p;i=p>=0?++h:--h)s.push(PIXI.Texture.fromFrame(e.animationName+"-"+i));r?(r.sequences[e.movement]={frames:s},e.frameRate&&(r.sequences[e.movement].frameRate=e.frameRate),e.loop&&(r.sequences[e.movement].loop=e.loop)):(n={},n[e.movement]={frames:s},e.frameRate&&(n[e.movement].frameRate=e.frameRate),e.loop&&(n[e.movement].loop=e.loop),r=new PIXI.AnimatedSprite(n)),r.nextSequence=null,r.onComplete=function(t){return!r.sequences[t].loop&&r.nextSequence?(r.gotoAndPlay(r.nextSequence),r.nextSequence=null):void 0}}else o=PIXI.Texture.fromImage(t.path),r=new PIXI.Sprite(o);return r},t.prototype._setSpriteProperties=function(t,e){var i,n,r,s,o,a,h,u;if(s=e.scale||1,s*=this.agent.getSize(),t.scale.x=s,t.scale.y=s,this.imageProperties.initialFlipDirection)switch(i=ExtMath.normalizeRads(this.agent.get("direction")),this.imageProperties.initialFlipDirection){case"left":-ExtMath.HALF_PI<i&&i<ExtMath.HALF_PI&&(t.scale.x*=-1);break;case"right":(-ExtMath.HALF_PI>i||i>ExtMath.HALF_PI)&&(t.scale.x*=-1);break;case"up":i>0&&i<Math.PI&&(t.scale.y*=-1);break;case"down":-Math.PI<i&&0>i&&(t.scale.y*=-1)}return this.imageProperties.rotate&&(r=this.imageProperties.initialRotationDirection||0,i=ExtMath.normalizeRads(this.agent.get("direction")),n=i-r,t.rotation=n),t.anchor.x=null!=(null!=(o=e.anchor)?o.x:void 0)?e.anchor.x:.5,t.anchor.y=null!=(null!=(a=e.anchor)?a.y:void 0)?e.anchor.y:.5,t.position.x=null!=(null!=(h=e.position)?h.x:void 0)?e.position.x:0,t.position.y=null!=(null!=(u=e.position)?u.y:void 0)?e.position.y:0,t},t}()}),require.register("views/environment-view",function(t,e,i){var n,r,s={}.hasOwnProperty;r=["add-agents","info-tool","carry-tool"],i.exports=n=function(){function t(t){this.environment=t.environment,this.showingWinter=!1,this._layers=[],null!=this.environment.winterImgPath&&(this.winterImgSprite=new PIXI.TilingSprite(PIXI.Texture.fromImage(this.environment.winterImgPath),this.environment.width,this.environment.height),this.winterImgSprite.anchor.x=0,this.winterImgSprite.anchor.y=0,this.winterImgSprite.position.x=0,this.winterImgSprite.position.y=0)}return t.prototype.showingBarriers=!1,t.prototype._backgroundSprite=null,t.prototype.render=function(){var t,e,i,n=this;return null==this.stage&&(this.stage=new PIXI.Stage(16777215,!0)),this.renderer=new PIXI.CanvasRenderer(this.environment.width,this.environment.height),i=PIXI.Texture.fromImage(this.environment.imgPath),e=this._getOrCreateLayer(0),this._backgroundSprite=new PIXI.Sprite(i),this._backgroundSprite.anchor.x=0,this._backgroundSprite.anchor.y=0,this._backgroundSprite.position.x=0,this._backgroundSprite.position.y=0,e.addChild(this._backgroundSprite),this.renderBarriers(e),this.renderAgents(),t=function(){var e,i,r,s;
for(requestAnimFrame(t),s=n.environment.agents,i=0,r=s.length;r>i;i++)e=s[i],e.getView().rerender(n._getOrCreateLayer(e._viewLayer));return n.environment.carriedAgent&&n.environment.carriedAgent.getView().rerender(n._getOrCreateLayer(100),"carry-tool"),n.barrierGraphics.visible=n.showingBarriers,n.renderer.render(n.stage)},requestAnimFrame(t),this.view=this.renderer.view,this.addMouseHandlers(),this.view},t.prototype.repaint=function(){return this.renderer.render(this.stage)},t.prototype.renderAgents=function(){var t,e,i,n,r;for(n=this.environment.agents,r=[],e=0,i=n.length;i>e;e++)t=n[e],r.push(t.getView().render(this._getOrCreateLayer(t._viewLayer)));return r},t.prototype.renderBarriers=function(t){return this.barrierGraphics=new PIXI.Graphics,this.rerenderBarriers(),t.addChild(this.barrierGraphics)},t.prototype.rerenderBarriers=function(){for(var t,e,i,n,r,s;this.barrierGraphics.children.length>0;)this.barrierGraphics.removeChild(this.barrierGraphics.children[0]);for(this.barrierGraphics.clear(),this.barrierGraphics.beginFill(16724736,.5),this.barrierGraphics.lineStyle(1,16767232,.5),s=this.environment.barriers,e=n=0,r=s.length;r>n;e=++n)t=s[e],this.barrierGraphics.drawRect(t.x1,t.y1,t.x2-t.x1,t.y2-t.y1),i=new PIXI.Text(""+e),i.position={x:t.x1+5,y:t.y1+5},this.barrierGraphics.addChild(i);return this.barrierGraphics.endFill(),this.barrierGraphics.visible=this.showingBarriers},t.prototype.removeAgent=function(t){return t.getView().remove(this._getOrCreateLayer(t._viewLayer))},t.prototype.removeCarriedAgent=function(t){return t.getView().remove(this._getOrCreateLayer(100))},t.prototype.setCursor=function(t){var e,i,n;if(this.view){for(i=0,n=r.length;n>i;i++)e=r[i],this.view.parentElement.classList.remove(e);return this.view.parentElement.classList.add(t)}},t.prototype.addWinterImage=function(){var t;return this.showingWinter=!0,t=this._getOrCreateLayer(101),this.winterImgSprite?t.addChild(this.winterImgSprite):void 0},t.prototype.removeWinterImage=function(){var t;return this.showingWinter=!1,t=this._getOrCreateLayer(101),this.winterImgSprite?t.removeChild(this.winterImgSprite):void 0},t.prototype.addMouseHandlers=function(){var t,e,i,n,r,s=this;for(n=["click","mousedown","mouseup","mousemove","touchstart","touchmove","touchend"],r=[],e=0,i=n.length;i>e;e++)t=n[e],r.push(this.view.addEventListener(t,function(t){return t instanceof TouchEvent?(t.envX=t.changedTouches[0].pageX-s.view.offsetLeft,t.envY=t.changedTouches[0].pageY-s.view.offsetTop):(t.envX=t.pageX-s.view.offsetLeft,t.envY=t.pageY-s.view.offsetTop),s.environment.send(t.type,t)}));return r},t.prototype.updateBackground=function(){var t;return t=PIXI.Texture.fromImage(this.environment.imgPath),this._backgroundSprite.setTexture(t)},t.prototype._getOrCreateLayer=function(t){var e,i,n,r;if(null==this._layers[t]&&(i=new PIXI.DisplayObjectContainer,this._layers[t]=i,null!=this.stage))try{n=0,r=this._layers;for(e in r)if(s.call(r,e)){if(!(t>e))break;n++}this.stage.addChildAt(i,n)}catch(o){this.stage.addChild(i)}return this._layers[t]},t}()});